# 테스트 구축하기

리팩터링을 제데로 하려면 불가피하게 저지르는 실수를 잡아주는 견고한 테스트 스위트가 뒷받침돼야 한다.

이게 단점은 아니다. 리팩터링을 하지 않더라도 좋은 테스트를 작성하는 일은 개발 효율을 높여준다. 테스트 작성에 시간을 뺴앗기는데 효율이 높아진다니? 직관에 어긋나는 효과라서 나도 처음 꺠달았을 때는 상당히 놀랬다. 자 그럼 효율이 좋아지는 이유를 함꼐 알아 보자

## 자가 테스트 코드의 위치

```
모든 테스트를 완전히 자동화하고 그 결과까지 스스로 검사하게 만들자
```

```
테스트 스위트는 강력한 버그 검출 도구로, 버그를 찾는데 걸리는 시간을 대폭 줄여준다.
```

테스를 작성하기 가장 좋은 시점은 프로그래밍을 시작하기 전이다. 나는 기능을 추가해야 할 떄 테스트부터 작성한다. 얼핏 순서가 뒤바뀐듯 들리지만, 전혀 그렇지 않다. 테스트를 작성하다 보면 원하는 기능을 추가하기 위해 무엇이 필요한지 고민하게 된다. 구현보다 인터페이스에 집중하게 된다는 장점도 있다.(무조건 좋은일). 게다가 코딩이 완료되는 시점을 정확하게 판단할 수 있다. 테스트를 모두 통과한 시점이 바로 코드를 완성한 시점이다.

켄트 백은 이처럼 테스트부터 작성하는 습관을 바탕으로 테스트 주도 개발(Test-Driven Development ;TDD)이란 기법을 창시했다. TDD에서는 (처음에 통과하지 못할) 테스트를 작성하고, 이 테스트를 통과하게끔 코드를 작성하고, 결과 코드를 최대한 깔끔하게 리팩터링하는 과정을 짧은 주기로 반복한다. 이러한 테스트-코딩-리팩터링 과정을 한 시간에도 여러 차례 진행하기 때문에 코드를 대단히 생산적이면서도 차분하게 작성할 수 있다. TDD에 대해서는 여기서 자세히 설명하지 않지만 내가프로그래밍하는 방식이자 추천하는 방식이다.

리팩터링에는 테스트가 필요하다. 그러니 리팩터링하고 싶다면 테스트를 반드시 작성해야 한다.

## 테스트할 샘플 코드

## 테스트 추가하기

명심하자! 테스트는 위험 요인을 중심으로 작성해야 한다. 테스트의 목적은 어디까지나 현재 혹은 향후에 발생하는 버그를 찾는 데 있다. 따라서 단순히 필드를 읽고 쓰기만 하는 접근자는 테스트할 필요가 없다. 이런 코드는 너무 단순해서 버그가 숨어들 가능성도 별로 없다.

테스트를 너무 많이 만들다 보면 오히려 필요한 테스트를 놓치기 쉽기 떄문에 아주 중요한 포인트다. 나는 적은 수의 테스트만으로 큰 효과를 얻고 있다. 잘못될까바 가장 걱정되는 영역을 집중적으로 테스트하는데, 이렇게 해서 테스트에 쏟는 노력의 효과를 극대화하는 것이다.

```
완벽하게 만드느라 테스트를 수행하지 못하느니, 불완전한 테스트라도 작성해 실행하는게 낫다.
```

## 경계 조건 검사하기

모든 일이 순조롭고 사용자도 우리 의도대로 사용하는, 일명 '꽃길'상황에 집중하였다. 그런데 이범위를 벗어나는 경계지점에서 문제가 생기면 어떤일이 벌어지는지 확인하는 테스트도 함께 작성하면 좋다.

```
문제가 생길 가능성이 있는 경계 조건을 생각해보고 그 부분을 집중적으로 테스트하자.
```

나는 리팩터링하기 전이라면 이런 테스트를 작성하지 않을 것이다. 리팩터링은 겉보기 동작에 영향을 주지 않아야 하며, 이런 오류는 겉보기 동작에 해당하지 않는다. 따라서 경계 조건에 대응하는 동작이 리팩터링 떄문에 변하는지는 신경 쓸 필요가 없다.

이런 오류로 인해 프로그램 내부에 잘못되 데이터가 흘러서 디버깅하기 어려운 문제가 발생한다면 어서션 추가하기를 적용해서 오류가 최대한 빨리 드러나게 하자

```
어차피 모든 버그를 잡아낼 수는 없다고 생각하여 테스트를 작성하지 않는다면 대다수의 버그를 잡을 수있는 기회를 날리는 셈이다.
```

테스트에도 수확 체감 법칙이 적용된다. 또 테스트를 너무 많이 작성하다 보면 오히려 의욕이 떨어져 나중에는 하나도 작성하지 않게 될 위험도 있다. 따라서 위험한 부분에 집중하는게 좋다. 코드에서 처리 과정이 복잡한 부분을 찾아보자. 함수에서 오류가 생길만한 부분을 찾아보자. 테스트가 모든 버그를 걸러주지는 못할지라도, 안심하고 리팩터링할 수 있는 보호막은 되어준다. 그리고 리팩터링을 하면서 프로그램을 더욱 깊이 이해하게 되어 더 많은 버그를 찾게 된다. 나는 항상 테스트 스위트부터 갖춘뒤에 리팩터링하지만, 리팩터링하는 동안에도 계속
해서 테스트를 추가한다.
